<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Attendance</title>
</head>
<body>

<h2>Attendance Form</h2>

<form id="attendanceForm">

  <input type="text" id="emp_name" placeholder="Employee Name" required><br><br>
  <input type="text" id="site_name" placeholder="Site Name" required><br><br>

  <label>
    <input type="radio" name="attendance" value="Check In" required> Check In
  </label>
  <label>
    <input type="radio" name="attendance" value="Check Out"> Check Out
  </label>
  <br><br>

  <label>
    <input type="radio" name="late" value="No" required> Not Late
  </label>
  <label>
    <input type="radio" name="late" value="Yes"> Late
  </label>
  <br><br>

  <input type="text" id="remarks" placeholder="Remarks"><br><br>

  <!-- SIMPLE CONFIRM CHECKBOX -->
  <label>
    <input type="checkbox" id="confirmAttendance" required>
    I confirm my attendance
  </label>
  <br><br>

  <button type="submit">Submit</button>
</form>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbyTBHy8KEWrUTayBQ6t4t-1P5_j_jlYTShzO2hIzQ1QHKIwwNuS00Qr91QIaROfsScn/exec";

let latitude = "";
let longitude = "";
let timestamp = "";

// checkbox tick → location + time
document.getElementById("confirmAttendance").addEventListener("change", function () {
  timestamp = new Date().toLocaleString();

  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(
      function(pos) {
        latitude = pos.coords.latitude;
        longitude = pos.coords.longitude;
      },
      function() {
        latitude = "";
        longitude = "";
      }
    );
  }
});

document.getElementById("attendanceForm").addEventListener("submit", function(e){
  e.preventDefault();

  const data = {
    emp_name: document.getElementById("emp_name").value,
    site_name: document.getElementById("site_name").value,
    attendance_type: document.querySelector('input[name="attendance"]:checked').value,
    late_status: document.querySelector('input[name="late"]:checked').value,
    remarks: document.getElementById("remarks").value,
    latitude: latitude,
    longitude: longitude,
    timestamp: timestamp
  };

  fetch(scriptURL, {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify(data)
  })
  .then(res => res.text())
  .then(() => {
    alert("Attendance Submitted ✅");
    document.getElementById("attendanceForm").reset();
    latitude = "";
    longitude = "";
    timestamp = "";
  })
  .catch(() => alert("Error ❌"));
});
</script>

</body>
</html>
